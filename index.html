<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¾ãã¡ã‚ƒã‚“ã®å†’é™º - ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¿·è·¯RPG</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #ffeef8, #f0e6ff);
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        .game-container {
            background: url('https://thumbs.dreamstime.com/b/brick-wall-seamless-texture-ancient-castle-stone-background-marble-pillars-vector-medieval-masonry-old-dungeon-rock-tiles-vintage-223995430.jpg');
            background-size: 200px 200px;
            border: 8px solid #8B4513;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        
        .status-panel {
            background: rgba(139, 69, 19, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        .action-button {
            background: linear-gradient(145deg, #ff9a9e, #fecfef);
            border: 3px solid #ff6b9d;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(255, 107, 157, 0.4);
            background: linear-gradient(145deg, #fecfef, #ff9a9e);
        }
        
        #gameCanvas {
            border: 4px solid #8B4513;
            border-radius: 10px;
            background: url('https://thumbs.dreamstime.com/b/stone-pavement-tiles-texture-cartoon-floor-seamless-pattern-rock-sidewalk-paver-loopable-background-game-ancient-cracked-walkway-220168830.jpg');
            background-size: 64px 64px;
        }
        
        .minimap {
            border: 3px solid #8B4513;
            border-radius: 8px;
            background: rgba(0,0,0,0.8);
        }
        
        .inventory-item {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #8B4513;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        
        .inventory-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .health-bar {
            background: linear-gradient(to right, #ff4757, #ff6b9d);
            border-radius: 10px;
            height: 20px;
            transition: width 0.5s ease;
        }
        
        .mana-bar {
            background: linear-gradient(to right, #3742fa, #70a1ff);
            border-radius: 10px;
            height: 20px;
            transition: width 0.5s ease;
        }
        
        .exp-bar {
            background: linear-gradient(to right, #2ed573, #7bed9f);
            border-radius: 10px;
            height: 15px;
            transition: width 0.5s ease;
        }
        
        .message-log {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            max-height: 150px;
            overflow-y: auto;
            color: white;
            font-size: 12px;
        }
        
        .character-sprite {
            width: 32px;
            height: 32px;
            background: url('https://img.craftpix.net/2023/03/Free-Fantasy-Chibi-Female-Sprites-Pixel-Art5.jpg');
            background-size: 256px 256px;
            background-position: 0 0;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .bounce { animation: bounce 0.5s ease-in-out; }
        
        @keyframes sparkle {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            100% { transform: scale(1.5) rotate(360deg); opacity: 0; }
        }
        
        .sparkle { animation: sparkle 1s ease-out forwards; }
    </style>
</head>
<body class="min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold text-center mb-6 text-pink-600 drop-shadow-lg">
            <i class="fas fa-crown text-yellow-400"></i> ã¾ãã¡ã‚ƒã‚“ã®å†’é™º - ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¿·è·¯RPG <i class="fas fa-crown text-yellow-400"></i>
        </h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
            <div class="lg:col-span-3">
                <div class="game-container p-4">
                    <canvas id="gameCanvas" width="800" height="600" class="w-full"></canvas>
                </div>
                
                <!-- æ“ä½œæ–¹æ³• -->
                <div class="mt-4 p-4 bg-white bg-opacity-90 rounded-lg shadow-lg">
                    <h3 class="text-lg font-bold text-gray-800 mb-2"><i class="fas fa-gamepad"></i> æ“ä½œæ–¹æ³•</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-700">
                        <div><kbd class="px-2 py-1 bg-gray-200 rounded">â†‘â†“â†â†’</kbd> ç§»å‹•</div>
                        <div><kbd class="px-2 py-1 bg-gray-200 rounded">Space</kbd> ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
                        <div><kbd class="px-2 py-1 bg-gray-200 rounded">E</kbd> ã‚¢ã‚¤ãƒ†ãƒ æ‹¾å¾—</div>
                        <div><kbd class="px-2 py-1 bg-gray-200 rounded">I</kbd> ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª</div>
                    </div>
                </div>
            </div>
            
            <!-- ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« -->
            <div class="lg:col-span-1">
                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
                <div class="status-panel p-4 mb-4">
                    <h3 class="text-xl font-bold mb-3"><i class="fas fa-user"></i> ã¾ãã¡ã‚ƒã‚“</h3>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>HP</span>
                                <span id="hpText">100/100</span>
                            </div>
                            <div class="bg-gray-700 rounded-full h-5">
                                <div id="hpBar" class="health-bar" style="width: 100%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>MP</span>
                                <span id="mpText">50/50</span>
                            </div>
                            <div class="bg-gray-700 rounded-full h-5">
                                <div id="mpBar" class="mana-bar" style="width: 100%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>çµŒé¨“å€¤</span>
                                <span id="expText">0/100</span>
                            </div>
                            <div class="bg-gray-700 rounded-full h-4">
                                <div id="expBar" class="exp-bar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="text-center">
                            <span class="text-lg font-bold">ãƒ¬ãƒ™ãƒ« <span id="levelText">1</span></span>
                        </div>
                        <div class="text-center">
                            <span class="text-yellow-300">ã‚¹ã‚³ã‚¢: <span id="scoreText">0</span></span>
                        </div>
                    </div>
                </div>
                
                <!-- ãƒŸãƒ‹ãƒãƒƒãƒ— -->
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-gray-800 mb-2"><i class="fas fa-map"></i> ãƒŸãƒ‹ãƒãƒƒãƒ—</h3>
                    <canvas id="minimap" width="200" height="150" class="minimap w-full"></canvas>
                </div>
                
                <!-- ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª -->
                <div class="mb-4 p-4 bg-white bg-opacity-90 rounded-lg shadow-lg">
                    <h3 class="text-lg font-bold text-gray-800 mb-2"><i class="fas fa-backpack"></i> ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª</h3>
                    <div id="inventory" class="grid grid-cols-4 gap-2">
                        <!-- ã‚¢ã‚¤ãƒ†ãƒ ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                    </div>
                </div>
                
                <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ­ã‚° -->
                <div class="message-log p-3 mb-4">
                    <h3 class="text-sm font-bold mb-2"><i class="fas fa-scroll"></i> ãƒ­ã‚°</h3>
                    <div id="messageLog" class="space-y-1">
                        <div>ã¾ãã¡ã‚ƒã‚“ã®å†’é™ºãŒå§‹ã¾ã‚Šã¾ã—ãŸï¼</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ã¾ãã¡ã‚ƒã‚“ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="mt-6 p-6 bg-white bg-opacity-90 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold text-center mb-4 text-pink-600">
                <i class="fas fa-heart"></i> ã¾ãã¡ã‚ƒã‚“ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ <i class="fas fa-heart"></i>
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒã„ã„å­ã«ãªã‚Šã¾ã—ãŸï¼ãŠæ‰‹ä¼ã„ã‚‚ãŒã‚“ã°ã‚Šã¾ã™ï¼')">
                    <i class="fas fa-angel"></i><br>ã„ã„å­ã¾ãã¡ã‚ƒã‚“
                </button>
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒã¡ã‚‡ã£ã¨ã„ãŸãšã‚‰ã—ã¡ã‚ƒã„ã¾ã—ãŸï¼ãˆã¸ã¸ã€œ')">
                    <i class="fas fa-grin-wink"></i><br>æ‚ªã„å­ã¾ãã¡ã‚ƒã‚“
                </button>
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒãŠæ‰‹ä¼ã„ã—ã¾ã™ï¼ä½•ã‚’ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ')">
                    <i class="fas fa-hands-helping"></i><br>ãŠæ‰‹ä¼ã„ã¾ãã¡ã‚ƒã‚“
                </button>
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒãŠç‰‡ä»˜ã‘ã—ã¾ã—ãŸï¼ãã‚Œã„ã«ãªã£ãŸã‚ˆã€œï¼')">
                    <i class="fas fa-broom"></i><br>ãŠç‰‡ä»˜ã‘ã¾ãã¡ã‚ƒã‚“
                </button>
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒå‹•ç”»ã‚’è¦‹ã¦ã„ã¾ã™ï¼é¢ç™½ã„å‹•ç”»ãŒã„ã£ã±ã„ï¼')">
                    <i class="fas fa-video"></i><br>å‹•ç”»é‘‘è³ã¾ãã¡ã‚ƒã‚“
                </button>
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒãŠã‚„ã¤ã‚’é£Ÿã¹ã¦ã„ã¾ã™ï¼ã¨ã£ã¦ã‚‚ç¾å‘³ã—ã„ã§ã™ã€œ')">
                    <i class="fas fa-cookie-bite"></i><br>ãŠã‚„ã¤ã‚¿ã‚¤ãƒ ã¾ãã¡ã‚ƒã‚“
                </button>
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒãŠæ˜¼å¯ä¸­ã§ã™...ã™ã‚„ã™ã‚„...zzz')">
                    <i class="fas fa-bed"></i><br>ãŠæ˜¼å¯ã¾ãã¡ã‚ƒã‚“
                </button>
                <button class="action-button px-4 py-3 rounded-lg font-bold text-white" onclick="speakAction('ã¾ãã¡ã‚ƒã‚“ãŒãŠæ•£æ­©ã«å‡ºã‹ã‘ã¾ã—ãŸï¼ã„ã„å¤©æ°—ã§ã™ã­ã€œ')">
                    <i class="fas fa-walking"></i><br>ãŠæ•£æ­©ã¾ãã¡ã‚ƒã‚“
                </button>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        const gameState = {
            player: {
                x: 1,
                y: 1,
                hp: 100,
                maxHp: 100,
                mp: 50,
                maxMp: 50,
                level: 1,
                exp: 0,
                maxExp: 100,
                score: 0,
                inventory: []
            },
            gameStarted: false,
            maze: [],
            monsters: [],
            items: [],
            mazeSize: 25
        };

        // ã‚­ãƒ£ãƒ³ãƒã‚¹è¨­å®š
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const minimap = document.getElementById('minimap');
        const minimapCtx = minimap.getContext('2d');

        // ç”»åƒã®èª­ã¿è¾¼ã¿
        const images = {
            wall: new Image(),
            floor: new Image(),
            character: new Image()
        };

        images.wall.src = 'https://thumbs.dreamstime.com/b/brick-wall-seamless-texture-ancient-castle-stone-background-marble-pillars-vector-medieval-masonry-old-dungeon-rock-tiles-vintage-223995430.jpg';
        images.floor.src = 'https://thumbs.dreamstime.com/b/stone-pavement-tiles-texture-cartoon-floor-seamless-pattern-rock-sidewalk-paver-loopable-background-game-ancient-cracked-walkway-220168830.jpg';
        images.character.src = 'https://img.craftpix.net/2023/03/Free-Fantasy-Chibi-Female-Sprites-Pixel-Art5.jpg';

        // è¿·è·¯ç”Ÿæˆ
        function generateMaze() {
            const size = gameState.mazeSize;
            const maze = Array(size).fill().map(() => Array(size).fill(1));
            
            function carve(x, y) {
                maze[y][x] = 0;
                const directions = [[0, 2], [2, 0], [0, -2], [-2, 0]];
                directions.sort(() => Math.random() - 0.5);
                
                for (const [dx, dy] of directions) {
                    const nx = x + dx;
                    const ny = y + dy;
                    if (nx > 0 && nx < size - 1 && ny > 0 && ny < size - 1 && maze[ny][nx] === 1) {
                        maze[y + dy/2][x + dx/2] = 0;
                        carve(nx, ny);
                    }
                }
            }
            
            carve(1, 1);
            gameState.maze = maze;
            
            // ã‚¢ã‚¤ãƒ†ãƒ ã¨ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é…ç½®
            placeItemsAndMonsters();
        }

        function placeItemsAndMonsters() {
            gameState.items = [];
            gameState.monsters = [];
            
            for (let i = 0; i < 10; i++) {
                let x, y;
                do {
                    x = Math.floor(Math.random() * gameState.mazeSize);
                    y = Math.floor(Math.random() * gameState.mazeSize);
                } while (gameState.maze[y][x] !== 0 || (x === gameState.player.x && y === gameState.player.y));
                
                if (Math.random() < 0.3) {
                    gameState.monsters.push({x, y, hp: 30, type: 'goblin'});
                } else {
                    gameState.items.push({
                        x, y, 
                        type: Math.random() < 0.5 ? 'potion' : 'treasure',
                        name: Math.random() < 0.5 ? 'å›å¾©ãƒãƒ¼ã‚·ãƒ§ãƒ³' : 'å®çŸ³'
                    });
                }
            }
        }

        // æç”»é–¢æ•°
        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const cellSize = Math.min(canvas.width / 15, canvas.height / 12);
            const startX = Math.max(0, gameState.player.x - 7);
            const startY = Math.max(0, gameState.player.y - 6);
            const endX = Math.min(gameState.mazeSize, startX + 15);
            const endY = Math.min(gameState.mazeSize, startY + 12);
            
            // è¿·è·¯ã‚’æç”»
            for (let y = startY; y < endY; y++) {
                for (let x = startX; x < endX; x++) {
                    const drawX = (x - startX) * cellSize;
                    const drawY = (y - startY) * cellSize;
                    
                    if (gameState.maze[y][x] === 1) {
                        // å£
                        ctx.fillStyle = '#654321';
                        ctx.fillRect(drawX, drawY, cellSize, cellSize);
                        if (images.wall.complete) {
                            ctx.drawImage(images.wall, drawX, drawY, cellSize, cellSize);
                        }
                    } else {
                        // åºŠ
                        ctx.fillStyle = '#deb887';
                        ctx.fillRect(drawX, drawY, cellSize, cellSize);
                        if (images.floor.complete) {
                            ctx.drawImage(images.floor, drawX, drawY, cellSize, cellSize);
                        }
                    }
                }
            }
            
            // ã‚¢ã‚¤ãƒ†ãƒ ã‚’æç”»
            gameState.items.forEach(item => {
                if (item.x >= startX && item.x < endX && item.y >= startY && item.y < endY) {
                    const drawX = (item.x - startX) * cellSize + cellSize/4;
                    const drawY = (item.y - startY) * cellSize + cellSize/4;
                    
                    ctx.fillStyle = item.type === 'potion' ? '#ff69b4' : '#ffd700';
                    ctx.fillRect(drawX, drawY, cellSize/2, cellSize/2);
                    ctx.fillStyle = 'white';
                    ctx.font = `${cellSize/3}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.fillText(item.type === 'potion' ? 'ğŸ’Š' : 'ğŸ’', drawX + cellSize/4, drawY + cellSize/3);
                }
            });
            
            // ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’æç”»
            gameState.monsters.forEach(monster => {
                if (monster.x >= startX && monster.x < endX && monster.y >= startY && monster.y < endY) {
                    const drawX = (monster.x - startX) * cellSize + cellSize/4;
                    const drawY = (monster.y - startY) * cellSize + cellSize/4;
                    
                    ctx.fillStyle = '#8b0000';
                    ctx.fillRect(drawX, drawY, cellSize/2, cellSize/2);
                    ctx.fillStyle = 'white';
                    ctx.font = `${cellSize/2}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ‘¹', drawX + cellSize/4, drawY + cellSize/2);
                }
            });
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æç”»
            const playerDrawX = (gameState.player.x - startX) * cellSize + cellSize/4;
            const playerDrawY = (gameState.player.y - startY) * cellSize + cellSize/4;
            
            ctx.fillStyle = '#ffb6c1';
            ctx.fillRect(playerDrawX, playerDrawY, cellSize/2, cellSize/2);
            ctx.fillStyle = 'white';
            ctx.font = `${cellSize/2}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText('ğŸŒ¸', playerDrawX + cellSize/4, playerDrawY + cellSize/2);
        }

        // ãƒŸãƒ‹ãƒãƒƒãƒ—æç”»
        function drawMinimap() {
            minimapCtx.clearRect(0, 0, minimap.width, minimap.height);
            
            const cellSize = Math.min(minimap.width / gameState.mazeSize, minimap.height / gameState.mazeSize);
            
            for (let y = 0; y < gameState.mazeSize; y++) {
                for (let x = 0; x < gameState.mazeSize; x++) {
                    const drawX = x * cellSize;
                    const drawY = y * cellSize;
                    
                    if (gameState.maze[y][x] === 1) {
                        minimapCtx.fillStyle = '#333';
                    } else {
                        minimapCtx.fillStyle = '#ccc';
                    }
                    minimapCtx.fillRect(drawX, drawY, cellSize, cellSize);
                }
            }
            
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½ç½®
            minimapCtx.fillStyle = '#ff69b4';
            minimapCtx.fillRect(gameState.player.x * cellSize, gameState.player.y * cellSize, cellSize, cellSize);
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•
        function movePlayer(dx, dy) {
            const newX = gameState.player.x + dx;
            const newY = gameState.player.y + dy;
            
            if (newX >= 0 && newX < gameState.mazeSize && 
                newY >= 0 && newY < gameState.mazeSize && 
                gameState.maze[newY][newX] === 0) {
                
                gameState.player.x = newX;
                gameState.player.y = newY;
                
                // ã‚¢ã‚¤ãƒ†ãƒ åé›†ãƒã‚§ãƒƒã‚¯
                const itemIndex = gameState.items.findIndex(item => 
                    item.x === newX && item.y === newY);
                if (itemIndex !== -1) {
                    const item = gameState.items[itemIndex];
                    gameState.items.splice(itemIndex, 1);
                    gameState.player.inventory.push(item);
                    
                    if (item.type === 'potion') {
                        gameState.player.hp = Math.min(gameState.player.maxHp, gameState.player.hp + 20);
                        addMessage(`${item.name}ã‚’è¦‹ã¤ã‘ã¦ä½“åŠ›ãŒå›å¾©ã—ã¾ã—ãŸï¼`);
                        speakAction(`${item.name}ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼ä½“åŠ›ãŒå›å¾©ã—ãŸã‚ˆã€œ`);
                    } else {
                        gameState.player.score += 100;
                        addMessage(`${item.name}ã‚’ç™ºè¦‹ï¼ã‚¹ã‚³ã‚¢ãŒä¸ŠãŒã‚Šã¾ã—ãŸï¼`);
                        speakAction(`å®ç‰©ã‚’ç™ºè¦‹ï¼ã¾ãã¡ã‚ƒã‚“å¤§å–œã³ã§ã™ã€œ`);
                    }
                    updateInventory();
                }
                
                // ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼æˆ¦é—˜ãƒã‚§ãƒƒã‚¯
                const monsterIndex = gameState.monsters.findIndex(monster => 
                    monster.x === newX && monster.y === newY);
                if (monsterIndex !== -1) {
                    const monster = gameState.monsters[monsterIndex];
                    const damage = Math.floor(Math.random() * 15) + 5;
                    gameState.player.hp = Math.max(0, gameState.player.hp - damage);
                    gameState.monsters.splice(monsterIndex, 1);
                    
                    gameState.player.exp += 25;
                    gameState.player.score += 50;
                    
                    addMessage(`ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã¨ã®æˆ¦é—˜ï¼${damage}ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ã¾ã—ãŸ`);
                    speakAction('ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒç¾ã‚Œã¾ã—ãŸï¼ã¾ãã¡ã‚ƒã‚“ãŒã‚“ã°ã£ã¦ï¼');
                    
                    if (gameState.player.exp >= gameState.player.maxExp) {
                        levelUp();
                    }
                }
                
                updateUI();
                drawGame();
                drawMinimap();
            }
        }

        // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
        function levelUp() {
            gameState.player.level++;
            gameState.player.exp -= gameState.player.maxExp;
            gameState.player.maxExp = Math.floor(gameState.player.maxExp * 1.5);
            gameState.player.maxHp += 10;
            gameState.player.hp = gameState.player.maxHp;
            gameState.player.maxMp += 5;
            gameState.player.mp = gameState.player.maxMp;
            
            addMessage(`ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ãƒ¬ãƒ™ãƒ«${gameState.player.level}ã«ãªã‚Šã¾ã—ãŸï¼`);
            speakAction(`ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ã¾ãã¡ã‚ƒã‚“ãŒå¼·ããªã‚Šã¾ã—ãŸã€œ`);
        }

        // UIæ›´æ–°
        function updateUI() {
            document.getElementById('hpText').textContent = `${gameState.player.hp}/${gameState.player.maxHp}`;
            document.getElementById('hpBar').style.width = `${(gameState.player.hp / gameState.player.maxHp) * 100}%`;
            
            document.getElementById('mpText').textContent = `${gameState.player.mp}/${gameState.player.maxMp}`;
            document.getElementById('mpBar').style.width = `${(gameState.player.mp / gameState.player.maxMp) * 100}%`;
            
            document.getElementById('expText').textContent = `${gameState.player.exp}/${gameState.player.maxExp}`;
            document.getElementById('expBar').style.width = `${(gameState.player.exp / gameState.player.maxExp) * 100}%`;
            
            document.getElementById('levelText').textContent = gameState.player.level;
            document.getElementById('scoreText').textContent = gameState.player.score;
        }

        // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ›´æ–°
        function updateInventory() {
            const inventory = document.getElementById('inventory');
            inventory.innerHTML = '';
            
            for (let i = 0; i < 12; i++) {
                const slot = document.createElement('div');
                slot.className = 'inventory-item h-10 flex items-center justify-center cursor-pointer';
                
                if (i < gameState.player.inventory.length) {
                    const item = gameState.player.inventory[i];
                    slot.textContent = item.type === 'potion' ? 'ğŸ’Š' : 'ğŸ’';
                    slot.title = item.name;
                } else {
                    slot.style.opacity = '0.3';
                }
                
                inventory.appendChild(slot);
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ 
        function addMessage(message) {
            const messageLog = document.getElementById('messageLog');
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.className = 'text-xs text-green-300';
            messageLog.appendChild(messageDiv);
            
            // æœ€å¤§10å€‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿æŒ
            while (messageLog.children.length > 10) {
                messageLog.removeChild(messageLog.firstChild);
            }
            
            messageLog.scrollTop = messageLog.scrollHeight;
        }

        // éŸ³å£°èª­ã¿ä¸Šã’
        function speakAction(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ja-JP';
                utterance.rate = 0.9;
                utterance.pitch = 1.2;
                speechSynthesis.speak(utterance);
            }
            addMessage(text);
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ
        document.addEventListener('keydown', (e) => {
            if (!gameState.gameStarted) return;
            
            switch(e.code) {
                case 'ArrowUp':
                case 'KeyW':
                    e.preventDefault();
                    movePlayer(0, -1);
                    break;
                case 'ArrowDown':
                case 'KeyS':
                    e.preventDefault();
                    movePlayer(0, 1);
                    break;
                case 'ArrowLeft':
                case 'KeyA':
                    e.preventDefault();
                    movePlayer(-1, 0);
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    e.preventDefault();
                    movePlayer(1, 0);
                    break;
                case 'Space':
                    e.preventDefault();
                    speakAction('ã¾ãã¡ã‚ƒã‚“ãŒå‘¨ã‚Šã‚’èª¿ã¹ã¾ã—ãŸï¼');
                    break;
                case 'KeyI':
                    e.preventDefault();
                    speakAction('ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã‚’ç¢ºèªã—ã¾ã—ãŸ');
                    break;
            }
        });

        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initGame() {
            generateMaze();
            gameState.player.x = 1;
            gameState.player.y = 1;
            gameState.gameStarted = true;
            
            updateUI();
            updateInventory();
            drawGame();
            drawMinimap();
            
            addMessage('ã¾ãã¡ã‚ƒã‚“ã®å†’é™ºãŒå§‹ã¾ã‚Šã¾ã—ãŸï¼');
            speakAction('ã¾ãã¡ã‚ƒã‚“ã®è¿·è·¯å†’é™ºãŒå§‹ã¾ã‚Šã¾ã—ãŸï¼çŸ¢å°ã‚­ãƒ¼ã§ç§»å‹•ã—ã¦å®ç‰©ã‚’æ¢ã—ã¾ã—ã‚‡ã†ï¼');
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        window.addEventListener('load', () => {
            // ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§å°‘ã—å¾…ã¤
            setTimeout(() => {
                initGame();
            }, 1000);
        });

        // ã‚»ãƒ¼ãƒ–æ©Ÿèƒ½
        function saveGame() {
            localStorage.setItem('makiChanRPG', JSON.stringify(gameState));
            addMessage('ã‚²ãƒ¼ãƒ ã‚’ã‚»ãƒ¼ãƒ–ã—ã¾ã—ãŸï¼');
        }

        // ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        function loadGame() {
            const saved = localStorage.getItem('makiChanRPG');
            if (saved) {
                Object.assign(gameState, JSON.parse(saved));
                updateUI();
                updateInventory();
                drawGame();
                drawMinimap();
                addMessage('ã‚²ãƒ¼ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
            }
        }

        // å®šæœŸçš„ãªè‡ªå‹•ä¿å­˜
        setInterval(saveGame, 30000);
    </script>
</body>
</html>
